import express from 'express'; import { query } from '../db.js'; export const searchRouter = express.Router(); searchRouter.get('/', async (req, res) => { const q = String(req.query.q || '').trim(); if (!q) return res.json([]); const r = await query(`SELECT id, title, url FROM videos WHERE to_tsvector('english', coalesce(title,'') || ' ' || coalesce(description,'')) @@ plainto_tsquery('english', $1) ORDER BY created_at DESC LIMIT 50`, [q]); res.json(r.rows); });