import express from 'express'; import fetch from 'node-fetch'; import { authRequired } from './middleware.js'; export const speechRouter = express.Router(); speechRouter.post('/token', authRequired, async (req, res) => { try { const key = process.env.AZURE_SPEECH_KEY; const region = process.env.AZURE_SPEECH_REGION; if (!key || !region) return res.status(500).json({ error: 'Speech key/region not configured' }); const tokenResp = await fetch(`https://${region}.api.cognitive.microsoft.com/sts/v1.0/issueToken`, { method: 'POST', headers: { 'Ocp-Apim-Subscription-Key': key } }); if (!tokenResp.ok) { const text = await tokenResp.text(); return res.status(502).json({ error: 'Failed to mint token', info: text }); } const token = await tokenResp.text(); res.json({ token, region }); } catch (err) { console.error(err); res.status(500).json({ error: 'Server error' }); } });